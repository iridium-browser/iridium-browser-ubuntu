<!DOCTYPE html>
<!--
Copyright 2017 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<!--
  Include all Diagnostic subclasses here so that RESERVED_INFOS always has
  access to all subclasses.
-->
<link rel="import" href="/tracing/value/diagnostics/all_diagnostics.html">

<script>
'use strict';
tr.exportTo('tr.v.d', function() {
  // Diagnostics that are produced outside of metrics (e.g. by telemetry) use
  // reserved names.
  const RESERVED_INFOS = {
    ANGLE_REVISIONS: {name: 'angle revisions', type: tr.v.d.GenericSet},
    ARCHITECTURES: {name: 'architectures', type: tr.v.d.GenericSet},
    BENCHMARKS: {name: 'benchmarks', type: tr.v.d.GenericSet},
    BENCHMARK_START: {name: 'benchmark start', type: tr.v.d.DateRange},
    BOTS: {name: 'bots', type: tr.v.d.GenericSet},
    BUG_COMPONENTS: {name: 'bug components', type: tr.v.d.GenericSet},
    BUILDS: {name: 'builds', type: tr.v.d.GenericSet},
    CATAPULT_REVISIONS: {name: 'catapult revisions', type: tr.v.d.GenericSet},
    CHROMIUM_COMMIT_POSITIONS: {
      name: 'chromium commit positions', type: tr.v.d.GenericSet},
    CHROMIUM_REVISIONS: {name: 'chromium revisions', type: tr.v.d.GenericSet},
    GPUS: {name: 'gpus', type: tr.v.d.GenericSet},
    GROUPING_PATH: {name: 'grouping path', type: tr.v.d.GroupingPath},
    LABELS: {name: 'labels', type: tr.v.d.GenericSet},
    LOG_URLS: {name: 'log urls', type: tr.v.d.GenericSet},
    MASTERS: {name: 'masters', type: tr.v.d.GenericSet},
    MEMORY_AMOUNTS: {name: 'memory amounts', type: tr.v.d.GenericSet},
    MERGED_FROM: {name: 'merged from', type: tr.v.d.RelatedHistogramSet},
    MERGED_TO: {name: 'merged to', type: tr.v.d.RelatedHistogramSet},
    OS_NAMES: {name: 'os names', type: tr.v.d.GenericSet},
    OS_VERSIONS: {name: 'os versions', type: tr.v.d.GenericSet},
    PRODUCT_VERSIONS: {name: 'product versions', type: tr.v.d.GenericSet},
    RELATED_NAMES: {name: 'related names', type: tr.v.d.GenericSet},
    SKIA_REVISIONS: {name: 'skia revisions', type: tr.v.d.GenericSet},
    STORIES: {name: 'stories', type: tr.v.d.GenericSet},
    STORYSET_REPEATS: {name: 'storyset repeats', type: tr.v.d.GenericSet},
    STORY_TAGS: {name: 'story tags', type: tr.v.d.GenericSet},
    TAG_MAP: {name: 'tagmap', type: tr.v.d.TagMap},
    TRACE_START: {name: 'trace start', type: tr.v.d.DateRange},
    TRACE_URLS: {name: 'trace urls', type: tr.v.d.GenericSet},
    V8_COMMIT_POSITIONS: {name: 'v8 commit positions', type: tr.v.d.DateRange},
    V8_REVISIONS: {name: 'v8 revisions', type: tr.v.d.GenericSet},
    WEBRTC_REVISIONS: {name: 'webrtc revisions', type: tr.v.d.GenericSet},

    // DEPRECATED https://github.com/catapult-project/catapult/issues/3507
    BUILDBOT: {name: 'buildbot'},  // BuildbotInfo or MergedBuildbotInfo
    DEVICE: {name: 'device'},  // DeviceInfo or MergedDeviceInfo
    INTERACTION_RECORD: {name: 'tir', type: tr.v.d.GenericSet},
    ITERATION: {name: 'iteration'},  // Legacy name for TELEMETRY
    REVISIONS: {name: 'revisions'},  // RevisionInfo or MergedRevisionInfo
    TELEMETRY: {name: 'telemetry'},  // TelemetryInfo or MergedTelemetryInfo

    // TODO(#3507) Change OWNERS to GenericSet of email addresses.
    OWNERS: {name: 'owners', type: tr.v.d.Ownership},
  };

  const RESERVED_NAMES = {};

  const RESERVED_NAMES_TO_TYPES = new Map();

  for (const [codename, info] of Object.entries(RESERVED_INFOS)) {
    RESERVED_NAMES[codename] = info.name;
    if (RESERVED_NAMES_TO_TYPES.has(info.name)) {
      throw new Error(`Duplicate reserved name "${info.name}"`);
    }
    RESERVED_NAMES_TO_TYPES.set(info.name, info.type);
  }

  const RESERVED_NAMES_SET = new Set(Object.values(RESERVED_NAMES));

  return {
    RESERVED_INFOS,
    RESERVED_NAMES,
    RESERVED_NAMES_SET,
    RESERVED_NAMES_TO_TYPES,
  };
});
</script>
