{"version":3,"sources":["javascript/javascript-parser.ts"],"names":[],"mappings":"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","file":"javascript-parser.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as espree from 'espree';\nimport * as estree from 'estree';\n\nimport {correctSourceRange, InlineDocInfo, LocationOffset, Severity, SourceRange, Warning, WarningCarryingException} from '../model/model';\nimport {ResolvedUrl} from '../model/url';\nimport {Parser} from '../parser/parser';\n\nimport {JavaScriptDocument} from './javascript-document';\n\nexport type SourceType = 'script' | 'module';\n\ndeclare class SyntaxError {\n  message: string;\n  lineNumber: number;\n  column: number;\n}\n\n// TODO(rictic): stop exporting this.\nexport const baseParseOptions = {\n  ecmaVersion: 8,\n  attachComment: true,\n  comment: true,\n  loc: true,\n};\n\nexport class JavaScriptParser implements Parser<JavaScriptDocument> {\n  sourceType: SourceType;\n\n  parse(contents: string, url: ResolvedUrl, inlineInfo?: InlineDocInfo<any>):\n      JavaScriptDocument {\n    const isInline = !!inlineInfo;\n    inlineInfo = inlineInfo || {};\n    const result = parseJs(\n        contents, url, inlineInfo.locationOffset, undefined, this.sourceType);\n    if (result.type === 'failure') {\n      // TODO(rictic): define and return a ParseResult instead of throwing.\n      const minimalDocument = new JavaScriptDocument({\n        url,\n        contents,\n        ast: null as any,\n        locationOffset: inlineInfo.locationOffset,\n        astNode: inlineInfo.astNode, isInline,\n        parsedAsSourceType: 'script',\n      });\n      throw new WarningCarryingException(\n          new Warning({parsedDocument: minimalDocument, ...result.warning}));\n    }\n\n    return new JavaScriptDocument({\n      url,\n      contents,\n      ast: result.program,\n      locationOffset: inlineInfo.locationOffset,\n      astNode: inlineInfo.astNode, isInline,\n      parsedAsSourceType: result.sourceType,\n    });\n  }\n}\n\nexport class JavaScriptModuleParser extends JavaScriptParser {\n  sourceType: SourceType = 'module';\n}\n\nexport class JavaScriptScriptParser extends JavaScriptParser {\n  sourceType: SourceType = 'script';\n}\n\nexport type ParseResult = {\n  type: 'success',\n  sourceType: SourceType,\n  program: estree.Program\n} | {\n  type: 'failure',\n  warning: {\n    sourceRange: SourceRange,\n    severity: Severity,\n    code: string,\n    message: string\n  }\n};\n\n/**\n * Parse the given contents and return either an AST or a parse error as a\n * Warning.\n *\n * It needs the filename and the location offset to produce correct warnings.\n */\nexport function parseJs(\n    contents: string,\n    file: string,\n    locationOffset?: LocationOffset,\n    warningCode?: string,\n    sourceType?: SourceType): ParseResult {\n  if (!warningCode) {\n    warningCode = 'parse-error';\n  }\n\n  let program: estree.Program;\n\n  try {\n    // If sourceType is not provided, we will try script first and if that\n    // fails, we will try module, since failure is probably that it can't parse\n    // the 'import' or 'export' syntax as a script.\n    if (!sourceType) {\n      try {\n        sourceType = 'script';\n        program = espree.parse(contents, {sourceType, ...baseParseOptions});\n      } catch (_ignored) {\n        sourceType = 'module';\n        program = espree.parse(contents, {sourceType, ...baseParseOptions});\n      }\n    } else {\n      program = espree.parse(contents, {sourceType, ...baseParseOptions});\n    }\n    return {\n      type: 'success',\n      sourceType: sourceType,\n      program: program,\n    };\n  } catch (err) {\n    if (err instanceof SyntaxError) {\n      return {\n        type: 'failure',\n        warning: {\n          message: err.message.split('\\n')[0],\n          severity: Severity.ERROR,\n          code: warningCode,\n          sourceRange: correctSourceRange(\n              {\n                file,\n                start: {line: err.lineNumber - 1, column: err.column - 1},\n                end: {line: err.lineNumber - 1, column: err.column - 1}\n              },\n              locationOffset)!\n        }\n      };\n    }\n    throw err;\n  }\n}\n"]}